<form id="update_party_form">
    <input type="text" name="contractingprocess_id" value = "<%= data.contractingprocess_id %>" hidden>
    <input type="text" name="parties_id" value = "<%= data.id %>" hidden>

     <div class="row col-xs-12">
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Miembro de <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li data-action="new_memberof"  data-id="<%= data.id %>"><a href="javascript:void(0)">Nuevo</a></li>
            <li data-action="edit_memberof" data-id="<%= data.id %>"><a href="javascript:void(0)">Editar</a></li>
        </ul>
    </div>

    <p><br><br><br>
        <label>Nombre común<!--Name--></label>
        <input name="name" type="text" class="form-control" value="<%= data.name %>"></p>

    <p>
        <label>Identificador del actor</label>
        <input name="partyid" type="text" class="form-control" value="<%= data.partyid %>" readonly required>
    </p>
    
    <p>
        <label>Cargo</label>
        <input name="position" type="text" class="form-control" value="<%= data.position %>">
    </p>
    
    <hr>
    <h4>Identificador principal</h4>
    
    <p>
        <label data-tooltip="crear_proceso">¿Es persona física?</label>
        <select name="naturalperson" id="naturalperson" class="form-control" required
        onchange="if(getElementById('naturalperson').selectedIndex == 0) 
            {document.getElementById('givenname').value = ''; 
             document.getElementById('givenname').disabled = true; 
             document.getElementById('surname').value = ''; 
             document.getElementById('surname').disabled = true; 
             document.getElementById('additionalsurname').value = '';
             document.getElementById('additionalsurname').disabled = true;
             document.getElementById('identifier_legalname').disabled = false;} 
            else
            {document.getElementById('identifier_legalname').value = '';
             document.getElementById('identifier_legalname').disabled = true;
             document.getElementById('givenname').disabled = false; 
             document.getElementById('surname').disabled = false; 
             document.getElementById('additionalsurname').disabled = false;}">

            <option value="<%= data.naturalperson %>"
              	parties.naturalperson === 'selected'
                > <%= data.naturalperson? 'Si':'No' %> </option>
            <option value="<%= !data.naturalperson %>"
                parties.naturalperson === 'selected'
                > <%= data.naturalperson? 'No':'Si' %> </option>
        </select>
    </p>
    
    <br>
    
    <div class="row">
		    
    	<div class="col-sm-6">
    		
    		<label data-tooltip="crear_proceso" title='El identificador principal de este actor. Los identificadores que señalan exclusivamente una entidad legal deben ser preferidos. Consulte la "Orientación del identificador de la organización" para el esquema preferido y el identificador a utilizar.'>
    		<h4>Persona moral</h4></label>
    		
    		<p><label>Nombre o razón social<!--Identifier legal name--></label>
        <input id="identifier_legalname" name = "identifier_legalname" class="form-control" type="text" value="<%= data.identifier_legalname %>" required <%= data.naturalperson? 'disabled' : '' %>></p>
        
        </div>
    	
		<div class="col-sm-6">
		<label data-tooltip="crear_proceso" title='El identificador principal de este actor. Los identificadores que señalan exclusivamente una entidad legal deben ser preferidos. Consulte la "Orientación del identificador de la organización" para el esquema preferido y el identificador a utilizar.'>
    		<h4>Persona física</h4></label>
     <p>
        <label>Nombre<!--Name--></label>
        <input id= "givenname" name="givenname" type="text" class="form-control" value="<%= data.givenname %>" required <%= !data.naturalperson ? 'disabled' : '' %>></p>

    <p>
    <p>
        <label>
        Primer Apellido</label>
        <input id="surname" name="surname" type="text" class="form-control"  value="<%= data.surname %>" required <%= !data.naturalperson ? 'disabled' : '' %>>
    </p>
    <p>
        <label>
        Segundo Apellido</label>
        <input id="additionalsurname" name="additionalsurname" type="text" class="form-control" value="<%= data.additionalsurname %>" required <%= !data.naturalperson ? 'disabled' : '' %>>
    </p>
    </div>
</div>


<!-- ########################################################################## MODIFICADO ##################################### -->
    <p><label>Esquema <!--Identifier scheme--></label>
        <select name="identifier_scheme" class="form-control" onChange="validarVacio(this);" id='identifier_scheme' requires>
            <option value="" <%= '' == data.identifier_scheme ? 'selected' : '' %>>Seleccionar un esquema</option>
            <option value="MX-RFC" <%= 'MX-RFC' == data.identifier_scheme ? 'selected' : '' %>>MX-RFC</option>
            <option value="MX-INAI" <%= 'MX-INAI' == data.identifier_scheme ? 'selected' : '' %>>MX-INAI</option>
            <option value="MX-UNAM" <%= 'MX-UNAM' == data.identifier_scheme ? 'selected' : '' %>>MX-UNAM</option>
        </select>
        <!-- <input name = "identifier_scheme" class="form-control" type="text" value="<%= data.identifier_scheme %>" onChange="validarVacio(this);" required></p> -->
<!-- ########################################################################## MODIFICADO ##################################### -->


    <p><label>Identificador<!--Identifier ID--></label>
        <input name = "identifier_id" class="form-control" type="text" value="<%= data.identifier_id %>" onChange="validarIdentificador(this);" required></p>

    <hr>
    
    <h4>Domicilio</h4>
    <p><label>Calle y número <!--Address street address--></label>
        <input name="address_streetaddress" type="text" class="form-control" value="<%= data.address_streetaddress %>" ></p>
    <p><label>Delegación o municipio<!--Address locality--></label>
        <input name="address_locality" type="text" class="form-control" value="<%= data.address_locality %>"></p>
    <p><label>Entidad federativa<!--Address region--></label>
        <input name="address_region" type="text" class="form-control" value="<%= data.address_region %>"></p>
    <p><label>Código postal<!--Address postal code--></label>
        <input name="address_postalcode" type="text" class="form-control" value="<%= data.address_postalcode %>"></p>
    <p><label>País<!--Address country name--></label>
        <input name="address_countryname" type="text" class="form-control" value="<%= data.address_countryname %>"></p>
    <hr>
    <h4>Punto de contacto</h4>
    <p><label>Tipo de punto de contacto</label>
        <select name="contactpoint_type" class="form-control">
            <option value="" <%= '' == data.contactpoint_type ? 'selected' : '' %>>- -</option>
            <option value="contactPoint" <%= 'contactPoint' == data.contactpoint_type ? 'selected' : '' %>>Punto de contacto</option>
            <option value="attorney" <%= 'attorney' == data.contactpoint_type ? 'selected' : '' %>>Abogado</option>
        </select></p>
    <p><label>Nombre<!--Contact point name--></label>
        <input name="contactpoint_givenname" type="text" class="form-control" value="<%= data.contactpoint_givenname || data.contactpoint_name %>"></p>
    <p>
        <label>
        Primer Apellido</label>
        <input name="contactpoint_surname" type="text" value="<%= data.contactpoint_surname %>" class="form-control">
    </p>

    <p>
        <label>
        Segundo Apellido</label>
        <input name="contactpoint_additionalsurname" value="<%= data.contactpoint_additionalsurname %>" type="text" class="form-control">
    </p>


    <p><label>Correo electrónico<!--Contact point email--></label>
        <input name="contactpoint_email" type="text" class="form-control" value="<%= data.contactpoint_email %>"></p>
    <p><label>Teléfono<!--Contact point telephone--></label>
        <input name="contactpoint_telephone"  type="text" class="form-control" value="<%= data.contactpoint_telephone %>"></p>
    <p><label>Número de fax<!--Contact point fax number--></label>
        <input name="contactpoint_faxnumber" type="text" class="form-control" value="<%= data.contactpoint_faxnumber %>"></p>
    <p><label>URL<!--Contact point url--></label>
        <input name="contactpoint_url"    type="url" class="form-control" value="<%= data.contactpoint_url %>"></p>
    <p><label>Idioma(s) disponible(s)</label>
        <select name="contactpoint_language" class="form-control" multiple>
            <% for(var i = 0; i < languages.length; i++) { %>
            <option value="<%= languages[i].name %>" <%= data.contactpoint_language ?  data.contactpoint_language.indexOf(languages[i].name) !== -1 ? 'selected' : '' : '' %>><%= languages[i].name + ' - ' + languages[i].alpha2 %></option>
            <% } %>
        </select></p>
        <hr>
    <div class="row col-xs-12">
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Punto de contacto adicional <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li data-action="new_contactpoint"  data-id="<%= data.id %>"><a href="javascript:void(0)">Nuevo</a></li>
            <li data-action="edit_contactpoints" data-id="<%= data.id %>"><a href="javascript:void(0)">Editar</a></li>
        </ul>
    </div>
<br><br><br>
        <label>Papeles del actor</label>
    <div class="well">
        <label class="checkbox-inline"><input name="contractingunit" type="checkbox"  <%= roles.contractingunit?'checked':'' %>>Área contratante</label><br>
        <label class="checkbox-inline"><input name="requestingunit" type="checkbox"  <%= roles.requestingunit?'checked':'' %>>Área requirente</label><br>
        <label class="checkbox-inline"><input name="technicalunit" type="checkbox"  <%= roles.technicalunit?'checked':'' %>>Área técnica</label><br>
        <label class="checkbox-inline"><input name="clarificationMeetingAttendee" type="checkbox"  <%= roles.clarificationmeetingattendee?'checked':'' %>>Asistente a junta de aclaraciones</label><br>
        <label class="checkbox-inline"><input name="reviewBody" type="checkbox"  <%= roles.reviewbody?'checked':'' %>>Auditor</label><br>
        <label class="checkbox-inline"><input name="payer" type="checkbox"  <%= roles.payer?'checked':'' %>>Emisor del pago</label><br>
        <label class="checkbox-inline"><input name="buyer" type="checkbox"  <%= roles.buyer?'checked':'' %>>Entidad compradora</label><br>
        <label class="checkbox-inline"><input name="procuringEntity" type="checkbox"  <%= roles.procuringentity?'checked':'' %>>Entidad contratante</label><br>
        <label class="checkbox-inline"><input name="guarantor" type="checkbox"  <%= roles.guarantor?'checked':'' %>>Institución que expide la garantía</label><br>
        <label class="checkbox-inline"><input name="tenderer" type="checkbox"  <%= roles.tenderer?'checked':'' %>>Licitante</label><br>
        <label class="checkbox-inline"><input name="enquirer" type="checkbox"  <%= roles.enquirer?'checked':'' %>>Persona física o moral que solicita aclaraciones</label><br>
        <label class="checkbox-inline"><input name="issuingSupplier" type="checkbox"  <%= roles.issuingsupplier?'checked':'' %>>Persona física o moral que envía cotización (investigación de mercado)</label><br>
    	<label class="checkbox-inline"><input name="invitedSupplier" type="checkbox"  <%= roles.invitedsupplier?'checked':'' %>>Persona física o moral invitada a cotizar (investigación de mercado)</label><br>
    	<label class="checkbox-inline"><input name="supplier" type="checkbox"  <%= roles.supplier?'checked':'' %>>Proveedor o contratista</label><br>
    	<label class="checkbox-inline"><input name="payee" type="checkbox"  <%= roles.payee?'checked':'' %>>Receptor de pago</label><br>
        <label class="checkbox-inline"><input name="clarificationMeetingOfficial" type="checkbox"  <%= roles.clarificationmeetingofficial?'checked':'' %>>Servidor público asistente a junta de aclaraciones</label><br>
    </div>

    <div class="row">
        <div class="col-sm-6">
            <button type="submit" class="btn btn-default">Guardar</button>
        </div>
        <div class="col-sm-6" style="text-align: right">
            <button name="delete_party" data-parties_id="<%= data.id %>" type="button" class="btn btn-danger">Eliminar</button>
        </div>
    </div>

</form>

<script>
    function validarVacio (input) {
        input.value = input.value.trim();
    }

    function validarIdentificador(input){
        input.value = input.value.trim();
        if(document.getElementById('identifier_scheme').selectedIndex == 1){
            if(input.value.length == 12 || input.value.length ==13){
                //No modifica el dato
            }else{
                alert("La longitud del identificador no coincide con el esquema seleccionado. Considerar que el RFC consta de 12 caracteres en caso de personas físicas y 13 en caso de personas morales.")
                input.value = "";
            }
        }else if(document.getElementById('identifier_scheme').selectedIndex == 2){
            if(input.value.length == 3){
                //No mofica el dato
            }else{
                alert("La longitud del identificador no coincide con el esquema seleccionado. Considerar que la clave interna de las unidades administrativas de INAI consta de 3 carateres.")
                input.value = "";
            }
        }else if(document.getElementById('identifier_scheme').selectedIndex == 3){
            if(input.value.length == 6){
                //No modifica el dato
            }else{
                alert("La longitud del identificador no coincide con el esquema seleccionado. Considerar que los identificadores internos de la UNAM constan de 6 caracteres.")
                input.value = "";
            }
        }
    }

    $('[name="identifier_scheme"], [name="identifier_id"]').on('change', function() {
        var scheme = $('[name="identifier_scheme"]').val();
        var id = $('[name="identifier_id"]').val();

        if (scheme == '' && id == '')
            $('[name="partyid"]').val('');
        else
            $('[name="partyid"]').val(scheme + '-' + id);
    });
</script>
